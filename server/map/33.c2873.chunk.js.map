{"version":3,"sources":["webpack:///./src/test-cases/StickDOM/Test.js","webpack:///./src/test-cases/StickDOM/stickyard.js","webpack:///./src/test-cases/StickDOM/StickDOM.js"],"names":["Test","react__WEBPACK_IMPORTED_MODULE_0___default","a","createElement","_StickDOM__WEBPACK_IMPORTED_MODULE_1__","Component","propTypes","__webpack_exports__","styleTransform","style","transform","WebkitTransform","styleTranslateY","offset","concat","Stickyard","props","_this","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","call","calulateIndexAndTransform","stickyIndex","translateY","sticker","stickPosition","_this$container","container","scrollTop","scrollHeight","offsetHeight","offsets","getStickyOffsets","stickers","length","setContainerRef","bind","_assertThisInitialized","setStickyRef","updateState","getStickyOffset","scrollToIndex","scrollTo","lastStickyIndex","updating","purgeStickers","addEventListener","removeEventListener","ref","position","overflowY","willChange","WebkitOverflowScrolling","push","offsetTop","offsetParent","map","index","_this$calulateIndexAn","_this$props","stickyClassName","onSticky","lastSticker","classList","add","remove","_this2","filter","sort","b","children","registerContainer","registerSticky","React","PureComponent","defaultProps","PropTypes","func","isRequired","string","oneOf","StickDOM","_Component","_getPrototypeOf2","_len","arguments","args","Array","_key","apply","handleScroll","e","console","log","target","ss","_inherits","_createClass","key","value","items","sticky","label","_stickyard__WEBPACK_IMPORTED_MODULE_2__","_ref","height","overflow","item","__reactstandin__regenerateByEval","code","eval"],"mappings":"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","file":"app/chunks/33.c2873.chunk.js","sourcesContent":["import React, { Component } from 'react';\r\nimport StickDOM from  './StickDOM';\r\nclass Test extends Component {\r\n  render() {\r\n    return (\r\n      <div>\r\n        <StickDOM/>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nTest.propTypes = {\r\n\r\n};\r\n\r\nexport default Test;","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst styleTransform = (style, transform) => {\r\n  style.transform = transform;\r\n  style.WebkitTransform = transform;\r\n};\r\n\r\nconst styleTranslateY = (style, offset) => {\r\n  styleTransform(style, `translateY(${offset}px) translateZ(0)`);\r\n};\r\n\r\n/**\r\n * Stickyard, make your component sticky the easy way using render prop\r\n */\r\nexport default class Stickyard extends React.PureComponent {\r\n  static defaultProps = {\r\n    stickPosition: 'top',\r\n  }\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.setContainerRef = this.setContainerRef.bind(this);\r\n    this.setStickyRef = this.setStickyRef.bind(this);\r\n    this.updateState = this.updateState.bind(this);\r\n    this.getStickyOffset = this.getStickyOffset.bind(this);\r\n    this.getStickyOffsets = this.getStickyOffsets.bind(this);\r\n    this.scrollToIndex = this.scrollToIndex.bind(this);\r\n    this.scrollTo = this.scrollTo.bind(this);\r\n\r\n    this.container = null;\r\n    this.stickers = [];\r\n    this.lastStickyIndex = -1;\r\n    this.updating = false;\r\n  }\r\n\r\n\r\n  componentDidMount() {\r\n    this.purgeStickers();\r\n    if (this.container) {\r\n      this.container.addEventListener('scroll', this.updateState);\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.purgeStickers();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.container) {\r\n      this.container.removeEventListener('scroll', this.updateState);\r\n    }\r\n  }\r\n\r\n  setContainerRef(ref) {\r\n    this.container = ref;\r\n    if (ref) {\r\n      // the postion should be either `relative` or `absolute`\r\n      if (ref.style.position !== 'absolute') {\r\n        ref.style.position = 'relative';\r\n      }\r\n      ref.style.overflowY = 'auto';\r\n      ref.style.willChange = 'transform';\r\n      ref.style.WebkitOverflowScrolling = 'touch';\r\n    }\r\n  }\r\n\r\n  setStickyRef(ref) {\r\n    if (ref) this.stickers.push(ref);\r\n  }\r\n\r\n  /**\r\n   * 计算\r\n   *\r\n   * @param {*} sticker\r\n   * @returns\r\n   * @memberof Stickyard\r\n   */\r\n  getStickyOffset(sticker) {\r\n    let { offsetTop, offsetParent } = sticker;\r\n    // offsetParent和定位有很大关系，和top left等定位一样的规则，向上查找position不为static的父级\r\n    // 所以这里算出固定元素相对于滚动元素的offsetTop，也就是固定元素据滚动区域的顶部距离。它是个定值\r\n    // 在setContainerRef已经设置了container的positon为absolute或relative\r\n    while (this.container && offsetParent !== this.container) {\r\n      offsetTop += offsetParent.offsetTop;\r\n      // eslint-disable-next-line prefer-destructuring\r\n      offsetParent = offsetParent.offsetParent;\r\n    }\r\n    return offsetTop;\r\n  }\r\n\r\n  getStickyOffsets() {\r\n    return this.stickers.map(this.getStickyOffset);\r\n  }\r\n\r\n  scrollTo(offset) {\r\n    if (this.container) {\r\n      this.container.scrollTop = offset;\r\n    }\r\n  }\r\n\r\n  scrollToIndex(index) {\r\n    if (index >= 0 && index < this.getStickyOffsets().length) {\r\n      this.scrollTo(this.getStickyOffsets()[index]);\r\n    }\r\n  }\r\n\r\n  updateState() {\r\n    if (this.updating || !this.container || this.stickers.length === 0) return;\r\n\r\n    this.updating = true;\r\n    // 计算\r\n    const { stickyIndex, sticker, translateY } = this.calulateIndexAndTransform();\r\n    // 设置样式\r\n    if (sticker) {\r\n      styleTranslateY(sticker.style, translateY);\r\n    }   \r\n\r\n    const { stickyClassName, onSticky } = this.props;\r\n    if (stickyIndex !== this.lastStickyIndex) {\r\n      const lastSticker = this.lastStickyIndex >= 0 ? this.stickers[this.lastStickyIndex] : null;\r\n\r\n      if (lastSticker) styleTransform(lastSticker.style, '');\r\n\r\n      if (stickyClassName) {\r\n        sticker && sticker.classList && sticker.classList.add(stickyClassName);\r\n        lastSticker\r\n          && lastSticker.classList\r\n          && lastSticker.classList.remove(stickyClassName);\r\n      }\r\n      onSticky && onSticky(stickyIndex);\r\n      this.lastStickyIndex = stickyIndex;\r\n    }\r\n\r\n    this.updating = false;\r\n  }\r\n\r\n  calulateIndexAndTransform = () => {\r\n    let stickyIndex = 0;\r\n    let translateY = 0;\r\n    let sticker = null;\r\n    const { stickPosition } = this.props;\r\n    const { scrollTop, scrollHeight, offsetHeight } = this.container;\r\n    if (stickPosition === 'top') {      \r\n      const offsets = this.getStickyOffsets().concat(scrollHeight);\r\n      \r\n      while (scrollTop >= offsets[stickyIndex]) {\r\n        stickyIndex += 1;\r\n      }\r\n      stickyIndex -= 1;\r\n\r\n      sticker = stickyIndex >= 0 ? this.stickers[stickyIndex] : null;\r\n\r\n      if (sticker) {\r\n        if (scrollTop < offsets[stickyIndex + 1] - sticker.offsetHeight) {\r\n          translateY = scrollTop - offsets[stickyIndex];\r\n        } else {\r\n          translateY = offsets[stickyIndex + 1] - offsets[stickyIndex] - sticker.offsetHeight;\r\n        }\r\n      }\r\n    } else {\r\n      const offsets = this.getStickyOffsets();\r\n      // 计算当前应该固定哪个元素\r\n      while (stickyIndex < this.stickers.length - 1\r\n        && scrollTop >= offsets[stickyIndex] - offsetHeight + this.stickers[stickyIndex].offsetHeight) {\r\n        stickyIndex += 1;\r\n      }\r\n      sticker = stickyIndex >= 0 ? this.stickers[stickyIndex] : null;\r\n      if (sticker) {\r\n        if (stickyIndex > 0 \r\n          && offsetHeight - offsets[stickyIndex - 1] + scrollTop - this.stickers[stickyIndex - 1].offsetHeight < sticker.offsetHeight) {\r\n          translateY = this.stickers[stickyIndex - 1].offsetHeight - offsets[stickyIndex] + offsets[stickyIndex - 1];\r\n        } else {\r\n          translateY = scrollTop + offsetHeight - sticker.offsetHeight - offsets[stickyIndex];\r\n        }\r\n      }\r\n    }\r\n    return {\r\n      stickyIndex,\r\n      sticker,\r\n      translateY,\r\n    };\r\n  }\r\n\r\n  purgeStickers() {\r\n    this.stickers = this.stickers\r\n      .filter(sticker => sticker && sticker.offsetHeight)\r\n      .sort((a, b) => this.getStickyOffset(a) - this.getStickyOffset(b));\r\n\r\n    this.updateState();\r\n  }\r\n\r\n  render() {\r\n    const { children } = this.props;\r\n    return children({\r\n      registerContainer: this.setContainerRef,\r\n      registerSticky: this.setStickyRef,\r\n      updateState: this.updateState,\r\n      getStickyOffsets: this.getStickyOffsets,\r\n      scrollToIndex: this.scrollToIndex,\r\n      scrollTo: this.scrollTo,\r\n    });\r\n  }\r\n}\r\n\r\nStickyard.propTypes = {\r\n  /**\r\n   * Render whatever you want, it's called with an object\r\n   */\r\n  children: PropTypes.func.isRequired,\r\n  /**\r\n   * The className to be attached to the element when it's sticky.\r\n   */\r\n  stickyClassName: PropTypes.string,\r\n  /**\r\n   * It's called when a element becomes sticky, `-1` means there is no sticky element.\r\n   */\r\n  onSticky: PropTypes.func,\r\n  stickPosition: PropTypes.oneOf(['top', 'bottom']),\r\n};\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Stickyard from './stickyard';\r\n\r\nexport class StickDOM extends Component {\r\n  handleScroll=(e) => {\r\n    console.log(e.target.offsetParent, this.ss.offsetParent, e.target.scrollHeight);\r\n    console.log(e.target.offsetTop, this.ss.offsetTop);\r\n  }\r\n\r\n  render() {\r\n    const items = [{\r\n      key: 1,\r\n      sticky: true,\r\n      label: 'test1',\r\n    }, {\r\n      key: 2,\r\n      sticky: false,\r\n      label: 'test2',\r\n    }, {\r\n      key: 3,\r\n      sticky: true,\r\n      label: 'test3',\r\n    }, {\r\n      key: 4,\r\n      sticky: true,\r\n      label: 'test4',\r\n    }, {\r\n      key: 5,\r\n      sticky: true,\r\n      label: 'test5',\r\n    }];\r\n    return (\r\n      <div>\r\n        <Stickyard stickPosition=\"bottom\">\r\n          {({ registerContainer, registerSticky }) => (\r\n            <div ref={registerContainer} style={{ height: 150, overflow: 'auto' }}>\r\n              {items.map((item, index) => (\r\n                <div>\r\n                  <div style={{ height: 60 }}>\r\n                    {'content'}\r\n                  </div>                  \r\n                  <div style={{ height: 50 }} key={item.key} ref={item.sticky ? registerSticky : null}>\r\n                    {item.label}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </Stickyard>       \r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\nexport default StickDOM;\r\n"],"sourceRoot":""}